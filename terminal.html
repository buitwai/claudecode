<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoZone Claude Code CLI Simulator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="terminal-styles.css">
</head>
<body>
    <div class="simulator-header">
        <div class="simulator-title">
            <i class="fas fa-robot"></i>
            AutoZone Claude Code CLI Simulator
            <span class="status-indicator status-connected"></span>
        </div>
        <div class="simulator-controls">
            <button class="control-btn" onclick="toggleHelp()">
                <i class="fas fa-question-circle"></i> Help
            </button>
            <button class="control-btn" onclick="clearTerminal()">
                <i class="fas fa-trash"></i> Clear
            </button>
            <button class="control-btn" onclick="resetSession()">
                <i class="fas fa-refresh"></i> Reset
            </button>
            <button class="control-btn" onclick="exportSession()">
                <i class="fas fa-download"></i> Export
            </button>
        </div>
    </div>

    <div class="terminal-container">
        <div class="terminal-header">
            <div class="terminal-title">
                <i class="fas fa-terminal"></i>
                Terminal - Claude Code Simulator
            </div>
            <div class="terminal-buttons">
                <button class="terminal-btn close" onclick="showExitModal()"></button>
                <button class="terminal-btn minimize"></button>
                <button class="terminal-btn maximize" onclick="toggleFullscreen()"></button>
            </div>
        </div>

        <div class="terminal-content" id="terminalContent">
            <div class="terminal-output" id="terminalOutput">
                <div class="success-output">
Welcome to AutoZone Claude Code CLI Simulator v1.0.0

This is a training environment for practicing Claude Code commands.
Type '/help' to see available commands or click the Help button.

Connected to: Training Environment (Simulated)
Working Directory: /Users/training/AutoZoneWorkSpace/demo-project
</div>
                <div class="prompt-line">
                    <span class="prompt autozone-prompt">az-claude:</span>
                    <span class="prompt">~/demo-project$</span>
                    <input type="text" class="input-line" id="commandInput" placeholder="Enter a command..." autocomplete="off">
                    <span class="cursor">|</span>
                </div>
            </div>

            <div class="autocomplete-suggestions" id="suggestions"></div>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-book"></i> Training Guide</h2>
        </div>
        <div class="sidebar-content">
            <div class="scenario-selector">
                <h3>Training Scenarios</h3>
                <button class="scenario-btn active" onclick="loadScenario('basic')">Basic Commands</button>
                <button class="scenario-btn" onclick="loadScenario('memory')">Memory Management</button>
                <button class="scenario-btn" onclick="loadScenario('workflow')">Development Workflow</button>
                <button class="scenario-btn" onclick="loadScenario('troubleshooting')">Troubleshooting</button>
                <button class="scenario-btn" onclick="loadScenario('advanced')">Advanced Features</button>
            </div>

            <div class="help-section">
                <h3><i class="fas fa-terminal"></i> Core Commands</h3>
                <div class="help-command">
                    <code>/help</code>
                    <p>Display available commands and usage information</p>
                </div>
                <div class="help-command">
                    <code>/status</code>
                    <p>Show current configuration and environment details</p>
                </div>
                <div class="help-command">
                    <code>/memory</code>
                    <p>View and edit memory context (CLAUDE.md)</p>
                </div>
                <div class="help-command">
                    <code>/clear</code>
                    <p>Clear conversation history</p>
                </div>
            </div>

            <div class="help-section">
                <h3><i class="fas fa-code"></i> Development Commands</h3>
                <div class="help-command">
                    <code>/init</code>
                    <p>Initialize CLAUDE.md with codebase documentation</p>
                </div>
                <div class="help-command">
                    <code>/review &lt;url&gt;</code>
                    <p>Review a pull request</p>
                </div>
                <div class="help-command">
                    <code>/cost</code>
                    <p>Show session cost and duration</p>
                </div>
            </div>

            <div class="help-section">
                <h3><i class="fas fa-keyboard"></i> Shortcuts</h3>
                <div class="help-command">
                    <code>Shift + Tab</code>
                    <p>Auto-edit mode for quick file modifications</p>
                </div>
                <div class="help-command">
                    <code>Ctrl + C</code>
                    <p>Cancel current operation</p>
                </div>
                <div class="help-command">
                    <code>Up/Down Arrow</code>
                    <p>Navigate command history</p>
                </div>
                <div class="help-command">
                    <code>Tab</code>
                    <p>Auto-complete commands</p>
                </div>
            </div>

            <div class="help-section">
                <h3><i class="fas fa-folder"></i> Project Files</h3>
                <div class="file-tree">
                    <div class="file-item folder">üìÅ demo-project/</div>
                    <div class="file-item">‚îú‚îÄ‚îÄ üìÑ CLAUDE.md</div>
                    <div class="file-item modified">‚îú‚îÄ‚îÄ üìÑ package.json *</div>
                    <div class="file-item folder">‚îú‚îÄ‚îÄ üìÅ src/</div>
                    <div class="file-item">‚îÇ   ‚îú‚îÄ‚îÄ üìÑ index.js</div>
                    <div class="file-item">‚îÇ   ‚îî‚îÄ‚îÄ üìÑ utils.js</div>
                    <div class="file-item folder">‚îú‚îÄ‚îÄ üìÅ tests/</div>
                    <div class="file-item">‚îî‚îÄ‚îÄ üìÑ README.md</div>
                </div>
            </div>
        </div>
    </div>

    <div class="terminal-overlay" id="terminalOverlay">
        <div class="modal">
            <h3>Exit Simulator</h3>
            <p>Are you sure you want to exit the Claude Code simulator?</p>
            <p>Your session progress will be saved automatically.</p>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="exitSimulator()">Exit</button>
                <button class="modal-btn secondary" onclick="hideExitModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="file-system-simulator.js"></script>
    <script src="command-processor.js"></script>
    <script src="session-manager.js"></script>
    <script src="cli-scenarios.js"></script>
    <script>
        // Terminal interface functionality
        let currentInput = '';
        let isTyping = false;
        let suggestionIndex = -1;

        const commandInput = document.getElementById('commandInput');
        const terminalOutput = document.getElementById('terminalOutput');
        const suggestions = document.getElementById('suggestions');

        // Initialize terminal
        document.addEventListener('DOMContentLoaded', function() {
            commandInput.focus();
            loadScenario('basic');
            
            // Welcome animation
            setTimeout(() => {
                addOutput('info-output', '\nType a command to get started. Try "/status" or "/help" for available options.\n');
            }, 1000);
        });

        // Handle input events
        commandInput.addEventListener('keydown', function(e) {
            switch(e.key) {
                case 'Enter':
                    e.preventDefault();
                    if (!isTyping) {
                        executeCommand(this.value.trim());
                        this.value = '';
                    }
                    break;
                case 'Tab':
                    e.preventDefault();
                    if (suggestionIndex >= 0) {
                        applyAutoComplete();
                    } else {
                        showAutoComplete(this.value);
                    }
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    if (suggestions.style.display === 'block') {
                        navigateSuggestions(-1);
                    } else {
                        showPreviousCommand();
                    }
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    if (suggestions.style.display === 'block') {
                        navigateSuggestions(1);
                    } else {
                        showNextCommand();
                    }
                    break;
                case 'Escape':
                    hideAutoComplete();
                    break;
            }
        });

        commandInput.addEventListener('input', function(e) {
            currentInput = this.value;
            if (this.value.length > 0) {
                showAutoComplete(this.value);
            } else {
                hideAutoComplete();
            }
        });

        // Auto-complete functionality
        function showAutoComplete(input) {
            const commands = getAvailableCommands();
            const filtered = commands.filter(cmd => 
                cmd.command.toLowerCase().includes(input.toLowerCase()) ||
                cmd.description.toLowerCase().includes(input.toLowerCase())
            );
            
            if (filtered.length > 0 && input.length > 0) {
                renderSuggestions(filtered);
                suggestions.style.display = 'block';
                suggestionIndex = -1;
            } else {
                hideAutoComplete();
            }
        }

        function renderSuggestions(commands) {
            suggestions.innerHTML = commands.map((cmd, index) => `
                <div class="suggestion-item" data-index="${index}" onclick="selectSuggestion(${index})">
                    <div class="suggestion-command">${cmd.command}</div>
                    <div class="suggestion-description">${cmd.description}</div>
                </div>
            `).join('');
        }

        function navigateSuggestions(direction) {
            const items = suggestions.querySelectorAll('.suggestion-item');
            if (items.length === 0) return;
            
            if (suggestionIndex >= 0) {
                items[suggestionIndex].classList.remove('selected');
            }
            
            suggestionIndex += direction;
            if (suggestionIndex < 0) suggestionIndex = items.length - 1;
            if (suggestionIndex >= items.length) suggestionIndex = 0;
            
            items[suggestionIndex].classList.add('selected');
            items[suggestionIndex].scrollIntoView({ block: 'nearest' });
        }

        function selectSuggestion(index) {
            suggestionIndex = index;
            applyAutoComplete();
        }

        function applyAutoComplete() {
            const selectedItem = suggestions.querySelector('.suggestion-item.selected') ||
                                suggestions.querySelector('.suggestion-item');
            if (selectedItem) {
                const command = selectedItem.querySelector('.suggestion-command').textContent;
                commandInput.value = command;
                hideAutoComplete();
                commandInput.focus();
            }
        }

        function hideAutoComplete() {
            suggestions.style.display = 'none';
            suggestionIndex = -1;
        }

        // Execute command
        async function executeCommand(command) {
            if (!command) return;
            
            // Add command to output
            addCommandToOutput(command);
            
            // Add to history
            sessionManager.addToHistory(command);
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Process command
                const result = await commandProcessor.execute(command);
                hideTypingIndicator();
                
                // Add result to output
                addOutput(result.type, result.message, result.details);
                
                // Handle special commands
                if (result.action) {
                    handleSpecialAction(result.action, result.data);
                }
                
            } catch (error) {
                hideTypingIndicator();
                addOutput('error-output', `Error: ${error.message}`);
            }
            
            // Scroll to bottom
            scrollToBottom();
        }

        function addCommandToOutput(command) {
            const promptLine = document.createElement('div');
            promptLine.className = 'prompt-line';
            promptLine.innerHTML = `
                <span class="prompt autozone-prompt">az-claude:</span>
                <span class="prompt">~/demo-project$</span>
                <span style="color: #ffffff; margin-left: 10px;">${command}</span>
            `;
            
            // Insert before the current input line
            const currentPrompt = terminalOutput.querySelector('.prompt-line:last-child');
            currentPrompt.parentNode.insertBefore(promptLine, currentPrompt);
        }

        function addOutput(type, message, details = null) {
            const output = document.createElement('div');
            output.className = `command-output ${type}`;
            
            let content = message;
            if (details) {
                content += '\n' + details;
            }
            
            output.textContent = content;
            
            // Insert before the current input line
            const currentPrompt = terminalOutput.querySelector('.prompt-line:last-child');
            currentPrompt.parentNode.insertBefore(output, currentPrompt);
        }

        function showTypingIndicator() {
            isTyping = true;
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.innerHTML = '<i class="fas fa-circle"></i> Claude is thinking...';
            indicator.style.display = 'block';
            
            const currentPrompt = terminalOutput.querySelector('.prompt-line:last-child');
            currentPrompt.parentNode.insertBefore(indicator, currentPrompt);
        }

        function hideTypingIndicator() {
            isTyping = false;
            const indicator = terminalOutput.querySelector('.typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function scrollToBottom() {
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }

        // Handle special actions
        function handleSpecialAction(action, data) {
            switch(action) {
                case 'clear':
                    clearTerminalContent();
                    break;
                case 'exit':
                    showExitModal();
                    break;
                case 'open_memory':
                    // Could open a modal for memory editing
                    break;
                case 'show_progress':
                    showProgress(data.progress);
                    break;
            }
        }

        // Utility functions
        function clearTerminal() {
            clearTerminalContent();
            addOutput('info-output', 'Terminal cleared.');
        }

        function clearTerminalContent() {
            const output = terminalOutput;
            const inputLine = output.querySelector('.prompt-line:last-child');
            output.innerHTML = '';
            output.appendChild(inputLine);
        }

        function resetSession() {
            sessionManager.reset();
            clearTerminalContent();
            addOutput('success-output', 'Session reset. Welcome back to the Claude Code simulator!');
        }

        function toggleHelp() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        }

        function showExitModal() {
            document.getElementById('terminalOverlay').style.display = 'flex';
        }

        function hideExitModal() {
            document.getElementById('terminalOverlay').style.display = 'none';
        }

        function exitSimulator() {
            sessionManager.save();
            window.close();
        }

        function exportSession() {
            const session = sessionManager.export();
            const blob = new Blob([JSON.stringify(session, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `claude-code-session-${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function showPreviousCommand() {
            const prev = sessionManager.getPreviousCommand();
            if (prev) {
                commandInput.value = prev;
            }
        }

        function showNextCommand() {
            const next = sessionManager.getNextCommand();
            if (next !== null) {
                commandInput.value = next;
            }
        }

        function showProgress(progress) {
            // Could implement a progress bar for long-running operations
            console.log('Progress:', progress);
        }

        // Load training scenario
        function loadScenario(scenarioName) {
            // Update active button
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event?.target?.classList.add('active');
            
            // Load scenario from cli-scenarios.js
            if (window.cliScenarios && window.cliScenarios.loadScenario) {
                window.cliScenarios.loadScenario(scenarioName);
            }
        }

        // Get available commands for autocomplete
        function getAvailableCommands() {
            return [
                { command: '/help', description: 'Display available commands and usage information' },
                { command: '/status', description: 'Show current configuration and environment details' },
                { command: '/memory', description: 'View and edit memory context (CLAUDE.md)' },
                { command: '/clear', description: 'Clear conversation history' },
                { command: '/exit', description: 'Exit the REPL' },
                { command: '/init', description: 'Initialize CLAUDE.md with codebase documentation' },
                { command: '/review', description: 'Review a pull request' },
                { command: '/pr-comments', description: 'Get comments from a GitHub pull request' },
                { command: '/cost', description: 'Show session cost and duration' },
                { command: '/resume', description: 'Resume a previously interrupted task' },
                { command: '/continue', description: 'Continue with the current task' },
                { command: '/pause', description: 'Pause the current operation' },
                { command: '/model', description: 'Change or view the current model' },
                { command: '/config', description: 'View or modify configuration settings' }
            ];
        }

        // Focus input when clicking anywhere in terminal
        document.getElementById('terminalContent').addEventListener('click', function() {
            commandInput.focus();
        });
    </script>
</body>
</html>